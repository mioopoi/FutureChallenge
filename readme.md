# 天池数据竞赛：未来已来——气象数据领航无人飞行器线路优化大赛

![logo](https://work.alibaba-inc.com/aliwork_tfs/g01_alibaba-inc_com/tfscom/TB1F2cNmamgSKJjSspiXXXyJFXa.tfsprivate.png)

比赛官网：[这里](https://tianchi.aliyun.com/competition/introduction.htm?spm=5176.100150.711.4.31e520099nlPtd&raceId=231622)

基本信息：

- 参加比赛时间：`2017.1.12`
- 结束时间：`2017.2.9`
- 初赛排名：`98 / 1646`
- 复赛排名：`54 / 1646`
- 本文档整理时间：`2018.2.11`
- 联系方式：`email: fanfan199308@gmail.com `

注：目前还未获得其他参赛者的思路，所以先只简单整理自己的~~naive的~~思路，等日后优秀队伍答辩完成，再把他们的做法补上来。

## 基本思路

这个问题直观上可以比较容易地分成两个子问题：天气预测和路径规划。当然这里的天气预测更准确地说，是想办法利用所提供的10个模型的预测结果，尽可能地降低预测误差。

天气预测的几个思路：

- 10个模型取均值，或者去掉最大最小取均值，或者中位数
- 把10个模型的预测值作为特征，建立机器学习模型做回归（或者分类）
- 增加特征：除了每个格点10个模型的预测值，也把其周围若干个点（比如周围8个格点）的值利用起来
- 先分类，再回归：对于风速而言，我们更关注那些值在15附近的格点，由于每个模型的准确率大约在90%到95%之间，预测我们可以抽出那些有预测值在`13.5~16.5`之间的格点单独做回归，而对于那些落在这个范围之外的格点，直接取平均即可，因为事实上我们并不关心它具体的风速是多少，而关心是否大于15或者小于15
- 其他各种模型融合的方法
- 复赛加入了降雨量这一天气因素，不过好在对它的处理不像风速那么难，但是思路依然可以延用
- 另外有一点还比较重要，如果做回归，可以设置阈值，比如给的是15，我们把阈值压到15以下，这样可以降低飞机坠毁的概率，至于具体设多少比较合适，和模型的预测精度有关，需要不断调试

路径规划的几个思路：

- 这是一个动态环境的路径规划问题，因为图的连通性会随着时间改变，虽然是offline问题（即图如何变化都是可以事先知道），但是搜索空间大，还是很有难度的


- 贪心：每个小时天气会变一次，在每个小时内就相当于一个二维静态图，这个用BFS或者A-star可以很快求解，然后取前30步能到达的那些点（因为每走一步用时两分钟）作为下一个小时的初始位置。所以越往后，每个小时开始的初始位置会越来越多，BFS会爆炸式增长，A-star相对少些。要想办法多剪枝。最终也许可以算出多条路径，取最短的即可。
- 三维A-star：把时间作为第三维度建图，寻路的时候强制按时间步长增加1个单位的方向搜索。因为是单向三维图，终点其实不再是一个点，而是一个长条状的形态，到达这个长条状的位置上任何一点都是可以的。所以可以先估计终点（需要估计到达终点的时间），然后对于这个估计的终点跑A-star，或者对所有可能的终点都跑一遍。启发式函数可以简单地定为起点到终点的二维曼哈顿距离。A-star的大多数情况下都可以较快地找到路径。
- 其他全局搜索算法，比如遗传算法、模拟退火等等。

时间关系，就用了均值+三维A星。。当然你也看到了，成绩不是多好，所以很想看到优秀的做法啊！！

## 源码

- 环境：Python3.5以上
- 依赖：`numpy, pandas, scikit-learn, xgboost`等

由于计算机内存容量的关系，我们是先把原文件按天分开，这样处理起来也方便一些。

指引：

```text
│  container.py
│
├─.idea IDEA的项目文件，不用管
│  │  encodings.xml
│  │  FutureChallenge.iml
│  │  misc.xml
│  │  modules.xml
│  │  workspace.xml
│  │
│  └─inspectionProfiles
├─data 这里存放原始的数据文件
│      ForecastDataforTesting_201802.csv
│
├─merge_data 存放融合10个模型之后的数据
├─results_tmp 存放路径的临时文件夹，一条路径一个文件
├─split_data 存放按天划分后的原数据
├─src 源代码
│      check_results.py 计算结果的路径长度
│      gen_result_file.py 生成提交文件
│      merge_model.py 融合10个模型得到预测结果
│      route.py 路径规划
│      split_data.py 按天划分数据
│      xgboost.model 训练好的xgboost模型
│
└─__pycache__
        container.cpython-36.pyc
```

原始数据下载地址: https://pan.baidu.com/s/1bqvLekJ 密码: `g78o`

运行顺序：

```
split_data-->merge_model-->route-->gen_result_file
```

